{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <title>{% block title %}Hogwarts Duels{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'core/css/style.css' %}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="UTF-8">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <ul class="nav">
      <li class="nav-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
      <form method="post" action="{% url 'logout' %}">
          {% csrf_token %}
          <button type="submit">Logout</button>
      </form>
    </ul>
  </nav>
  
  <main>
    {% block content %}{% endblock %}
  </main>
  
    <footer>
        <p>&copy; 2023 Hogwarts Duels</p>
    </footer>

  <div id="duel-notifications"></div>
  <script>
      const csrfToken = "{{ csrf_token }}";
  </script>
  <script src="{% static 'core/js/main.js' %}"></script>
  {% if user.is_authenticated %}
  <script>
    function getDuelInvitations() {
        fetch("{% url 'get_duel_invitations' %}")
        .then(res => res.json())
        .then(data => {
            const notificationsDiv = document.getElementById('duel-notifications');
            notificationsDiv.innerHTML = ''; // Clear old notifications
            data.forEach(invitation => {
                const notification = document.createElement('div');
                notification.className = 'alert alert-info';
                notification.innerHTML = `
                    You have a duel invitation from <strong>${invitation.challenger}</strong>.
                    <a href="/duel/${invitation.id}/" class="btn btn-sm btn-primary">View</a>
                `;
                notificationsDiv.appendChild(notification);
            });
        })
        .catch(err => console.error('Error fetching duel invitations:', err));
    }

    setInterval(getDuelInvitations, 5000); // Poll every 5 seconds
    getDuelInvitations(); // Initial check
  </script>
  {% endif %}
</body>
</html>
